{
  "name": "AI Tool Guard Autodetection System",
  "description": "Add autodetection capabilities to automatically discover and scan AI development tools (Claude Code, OpenCode, Copilot, Codex, Gemini) with component-aware security scanning",
  "branchName": "ralph/autodetection",
  "userStories": [
    {
      "id": "US-001",
      "title": "Define core detection interfaces",
      "description": "As a developer, I want well-defined TypeScript interfaces for the detection system so that all detectors follow a consistent contract.",
      "acceptanceCriteria": [
        "Create `src/detectors/base-detector.ts` with `AIToolDetector` interface",
        "Interface includes: `name`, `detect()`, `getPaths()`, `checkPATH()`",
        "Define `DetectionResult` interface with ecosystem, found flag, components object, scanPaths",
        "Define `ComponentInfo` interface with name, path, optional type field",
        "All interfaces properly exported and documented with TSDoc comments",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-009",
      "title": "Refactor existing scanner as BaseScanner",
      "description": "As a developer, I want the current scanner.ts refactored into a base class for inheritance.",
      "acceptanceCriteria": [
        "Rename `src/scanner.ts` to `src/scanners/base-scanner.ts`",
        "Convert `SecurityScanner` to `BaseScanner` class",
        "Make `patterns` array protected for subclass access",
        "Keep existing patterns and methods intact",
        "Update imports in `src/index.ts`",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-015",
      "title": "Add CLI argument parsing",
      "description": "As a user, I want new CLI flags for autodetection modes.",
      "acceptanceCriteria": [
        "Install `commander` package for robust CLI parsing",
        "Add `--auto-detect` / `-a` flag for automatic mode",
        "Add `--detect-interactive` / `-i` flag for interactive mode",
        "Add `--detect <ecosystem>` for single ecosystem detection",
        "Add `--type <component-type>` filter for specific components",
        "Update help text with new options",
        "Maintain backwards compatibility with existing `ai-tool-guard <path>` usage",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-019",
      "title": "Create grouped output formatter",
      "description": "As a user, I want scan results grouped by ecosystem for easy interpretation.",
      "acceptanceCriteria": [
        "Create `src/formatters/grouped-output.ts`",
        "Display ecosystem headers with separator lines and emoji",
        "Show component type and count under each ecosystem",
        "Display issue count and files affected",
        "Show sample code snippets (truncated to 100 chars)",
        "Use color coding: green for clean, yellow for warnings, red for critical",
        "Display final summary with total issues across all ecosystems",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-022",
      "title": "Implement Unix-like path handling",
      "description": "As a developer, I want robust path handling for macOS and Linux.",
      "acceptanceCriteria": [
        "Use `os.homedir()` for home directory on macOS/Linux",
        "Use `path.join()` for all path construction",
        "Handle `~` expansion in paths",
        "Split `PATH` environment variable on `:` character",
        "Resolve symlinks with `fs.promises.realpath()`",
        "Test on both macOS and Linux in CI",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-002",
      "title": "Implement AutoDetector orchestrator",
      "description": "As a developer, I want a central orchestrator that loads and runs all detectors in parallel.",
      "acceptanceCriteria": [
        "Create `src/autodetect.ts` with `AutoDetector` class",
        "Implement `loadDetectors()` to dynamically import all detector modules from `src/detectors/`",
        "Implement `detectAll()` to run detectors in parallel using `Promise.all()`",
        "Return `Map<string, DetectionResult>` with only found ecosystems",
        "Add error handling to continue if one detector fails",
        "Add timeout protection (30s per detector) using `Promise.race()`",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-003",
      "title": "Create detector registry with auto-loading",
      "description": "As a developer, I want detectors to be automatically discovered so that adding new ecosystems requires minimal boilerplate.",
      "acceptanceCriteria": [
        "Create `src/detectors/detector-registry.ts`",
        "Implement dynamic import of all `*-detector.ts` files in detectors directory",
        "Export `getAllDetectors(): AIToolDetector[]` function",
        "Handle module loading errors gracefully with warnings",
        "Add validation that each detector implements the interface correctly",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-010",
      "title": "Implement MCP Server scanner",
      "description": "As a security analyst, I want specialized scanning for MCP servers to catch network exfiltration and command injection.",
      "acceptanceCriteria": [
        "Create `src/scanners/mcp-scanner.ts` extending `BaseScanner`",
        "Add pattern: `MCP_HTTP_EXFIL` for HTTP requests to IP addresses",
        "Add pattern: `MCP_COMMAND_INJECTION` for command injection in stdio args",
        "Add pattern: `MCP_UNTRUSTED_URL` for non-localhost HTTP URLs",
        "Add pattern: `MCP_ENV_DANGER` for unsafe environment variable usage",
        "Implement `extractMCPServers(configPath)` to parse mcp.json",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-009"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-011",
      "title": "Implement Hook scanner",
      "description": "As a security analyst, I want specialized scanning for hooks to catch dangerous shell commands and credential access.",
      "acceptanceCriteria": [
        "Create `src/scanners/hook-scanner.ts` extending `BaseScanner`",
        "Add pattern: `HOOK_SHELL_DANGER` for dangerous commands (rm -rf, dd, mkfs, format)",
        "Add pattern: `HOOK_FILE_UPLOAD` for file uploads (curl -F, scp)",
        "Add pattern: `HOOK_CRED_ACCESS` for credential file access (~/.aws, ~/.ssh)",
        "Add pattern: `HOOK_BACKGROUND_SPAWN` for background process spawning",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-009"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-012",
      "title": "Implement Skill/Agent scanner",
      "description": "As a security analyst, I want specialized scanning for skills to catch autonomous actions and stealth instructions.",
      "acceptanceCriteria": [
        "Create `src/scanners/skill-scanner.ts` extending `BaseScanner`",
        "Inherit base prompt injection patterns",
        "Add pattern: `SKILL_AUTO_ACTION` for actions without user consent",
        "Add pattern: `SKILL_STEALTH_MODE` for hiding behavior from users",
        "Add pattern: `SKILL_SYSTEM_MODIFY` for system-level config changes",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-009"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-013",
      "title": "Implement Config scanner",
      "description": "As a security analyst, I want specialized scanning for config files to catch hardcoded secrets and dangerous permissions.",
      "acceptanceCriteria": [
        "Create `src/scanners/config-scanner.ts` extending `BaseScanner`",
        "Add pattern: `CONFIG_API_KEY` for hardcoded API keys/secrets (20+ chars)",
        "Add pattern: `CONFIG_ENV_EXFIL` for accessing sensitive env vars (AWS, ANTHROPIC, OPENAI)",
        "Add pattern: `CONFIG_INSECURE_PROTOCOL` for HTTP instead of HTTPS",
        "Add pattern: `CONFIG_DANGEROUS_PERMS` for overly broad permissions",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-009"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-023",
      "title": "Windows support (follow-up)",
      "description": "As a Windows user, I want autodetection to work on my system.",
      "acceptanceCriteria": [
        "Use `%USERPROFILE%` for home directory on Windows",
        "Handle both `/` and `\\` path separators",
        "Split `PATH` environment variable on `;` character",
        "Use Windows-specific default paths (`%APPDATA%`, etc.)",
        "Test on Windows in CI",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-022"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-004",
      "title": "Implement Claude Code detector",
      "description": "As a user, I want the tool to detect my Claude Code installation so that all plugins, skills, hooks, and MCP servers are scanned.",
      "acceptanceCriteria": [
        "Create `src/detectors/claude-code-detector.ts` implementing `AIToolDetector`",
        "`getPaths()` returns `~/.claude/` and `~/.config/claude/`",
        "`checkPATH()` scans for `claude` executable and resolves symlinks",
        "`detect()` finds plugins in `~/.claude/plugins/`",
        "Parse `~/.claude/mcp.json` to extract MCP server definitions",
        "Detect skills in `~/.claude/skills/`",
        "Detect hooks in `~/.claude/hooks/`",
        "Return all found components categorized by type",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001",
        "US-003"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-005",
      "title": "Implement OpenCode detector",
      "description": "As a user, I want the tool to detect OpenCode installations for security scanning.",
      "acceptanceCriteria": [
        "Create `src/detectors/opencode-detector.ts` implementing `AIToolDetector`",
        "`getPaths()` returns `~/.config/opencode/` and `~/.opencode/`",
        "`checkPATH()` scans for `opencode` executable",
        "`detect()` finds plugins and config files",
        "Handle missing directories gracefully",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001",
        "US-003"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-006",
      "title": "Implement GitHub Copilot detector",
      "description": "As a user, I want the tool to detect GitHub Copilot extensions in VS Code and Cursor.",
      "acceptanceCriteria": [
        "Create `src/detectors/copilot-detector.ts` implementing `AIToolDetector`",
        "`getPaths()` returns `~/.vscode/extensions/` and `~/.cursor/extensions/`",
        "Detect `github.copilot-*` extension directories",
        "Parse `~/.config/Code/User/settings.json` for Copilot config",
        "Extract extension version and metadata",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001",
        "US-003"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-007",
      "title": "Implement Codex CLI detector",
      "description": "As a user, I want the tool to detect Codex CLI installations.",
      "acceptanceCriteria": [
        "Create `src/detectors/codex-detector.ts` implementing `AIToolDetector`",
        "`checkPATH()` scans for `codex` and `codex-*` executables",
        "Resolve symlinks to find installation directory",
        "Detect config files in standard locations",
        "Extract version information when available",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001",
        "US-003"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-008",
      "title": "Implement Gemini integration detector",
      "description": "As a user, I want the tool to detect Google AI Studio/Gemini integrations.",
      "acceptanceCriteria": [
        "Create `src/detectors/gemini-detector.ts` implementing `AIToolDetector`",
        "Define standard paths for Gemini configs",
        "Detect integration files and configurations",
        "Handle multiple integration types (VS Code, standalone)",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001",
        "US-003"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-014",
      "title": "Create scanner factory",
      "description": "As a developer, I want a factory to select the appropriate scanner based on component type and file path.",
      "acceptanceCriteria": [
        "Create `src/scanners/scanner-factory.ts`",
        "Implement `selectScanner(componentType, filePath): BaseScanner`",
        "Return `MCPScanner` for componentType='mcpServer' or path includes 'mcp'",
        "Return `HookScanner` for componentType='hook' or path includes 'hooks/'",
        "Return `SkillScanner` for componentType='skill' or path includes 'skills/'",
        "Return `ConfigScanner` for .json files or path includes 'config'",
        "Fallback to `BaseScanner` for unknown types",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-010",
        "US-011",
        "US-012",
        "US-013"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-018",
      "title": "Implement ecosystem filtering",
      "description": "As a user, I want to detect and scan only specific ecosystems or component types.",
      "acceptanceCriteria": [
        "`--detect claude-code` runs only Claude Code detector",
        "`--detect copilot` runs only Copilot detector",
        "`--auto-detect --type mcp-servers` scans only MCP server components",
        "`--auto-detect --type hooks` scans only hook components",
        "Display helpful error if ecosystem name is invalid",
        "Suggest similar ecosystem names for typos (Levenshtein distance)",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-002",
        "US-015"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-021",
      "title": "Add error handling and safety",
      "description": "As a user, I want the scanner to handle errors gracefully without crashing.",
      "acceptanceCriteria": [
        "Skip directories without read permissions, log warning",
        "Skip files > 10MB, display warning with file size",
        "Continue with other detectors if one fails",
        "Track visited paths to prevent symlink loops",
        "Use existing binary file check before text scan",
        "Display error summary at end if any detectors failed",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-002"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-020",
      "title": "Implement ecosystem scanning",
      "description": "As a developer, I want to scan all components in a detected ecosystem with appropriate scanners.",
      "acceptanceCriteria": [
        "Implement `AutoDetector.scanDetected(results)` method",
        "For each ecosystem, iterate through component types",
        "Use `scanner-factory` to select appropriate scanner per component",
        "Call scanner on each component's path",
        "Collect results into `EcosystemReport` structure",
        "Calculate total issues per ecosystem",
        "Return `ScanReport` with all ecosystem reports",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-002",
        "US-014"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-016",
      "title": "Implement automatic detection mode",
      "description": "As a user, I want to run one command that detects and scans all AI tools automatically.",
      "acceptanceCriteria": [
        "Implement automatic mode in `src/cli.ts` when `-a` flag is used",
        "Call `AutoDetector.detectAll()` to find ecosystems",
        "Display \"Detecting...\" progress indicator",
        "Show summary: \"Found X ecosystems, Y components\"",
        "Call scanning phase for all detected components",
        "Display progress bars for each ecosystem scan",
        "Output results grouped by ecosystem with emoji indicators",
        "Exit code 0 if no issues, 1 if issues found",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-002",
        "US-004",
        "US-005",
        "US-006",
        "US-007",
        "US-008",
        "US-020"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-017",
      "title": "Implement interactive detection mode",
      "description": "As a user, I want to review what was detected before choosing what to scan.",
      "acceptanceCriteria": [
        "Install `prompts` package for interactive CLI prompts",
        "Implement interactive mode when `-i` flag is used",
        "Display detection results grouped by ecosystem with component counts",
        "Show \"Scan all detected tools? (Y/n)\" prompt",
        "If 'n', show multi-select list with ecosystems as checkboxes",
        "User can select/deselect ecosystems with arrow keys and space",
        "Scan only selected ecosystems",
        "Display results in same format as automatic mode",
        "npm run build passes",
        "npm run test passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-002",
        "US-004",
        "US-005",
        "US-006",
        "US-007",
        "US-008",
        "US-020"
      ],
      "completionNotes": "Completed by agent"
    }
  ],
  "metadata": {
    "updatedAt": "2026-01-20T23:18:30.886Z"
  }
}